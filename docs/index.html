<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- App Title -->
    <title>ניהול הסעות החוג</title>
    <meta name="description" content="אפליקציה לתיאום הסעות לחוגי ילדים - ניהול משפחות, זמינות, וקבוצות הסעות">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Theme Colors -->
    <meta name="theme-color" content="#3b82f6">
    <meta name="msapplication-TileColor" content="#3b82f6">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- App Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="./icons/icon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="./icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="./icons/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="114x114" href="./icons/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="76x76" href="./icons/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="72x72" href="./icons/icon-72x72.png">
    <link rel="apple-touch-icon" href="./icons/icon-192x192.png">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="הסעות חוג">
    
    <!-- Microsoft Tile -->
    <meta name="msapplication-TileImage" content="./icons/icon-144x144.png">
    
    <!-- Open Graph -->
    <meta property="og:title" content="ניהול הסעות החוג">
    <meta property="og:description" content="אפליקציה לתיאום הסעות לחוגי ילדים">
    <meta property="og:image" content="./icons/icon-512x512.png">
    <meta property="og:url" content="https://motyarbel2021.github.io/Carpool-Coordination-App-for-Kids-Activities/">
    <meta property="og:type" content="website">
    
    <!-- External CSS and JS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- App Styles -->
    <link href="./styles.css" rel="stylesheet">
    
    <!-- PWA Install Styles -->
    <style>
        /* PWA Install Banner */
        .pwa-install-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 16px;
            display: none;
            z-index: 1000;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
        }
        .pwa-install-banner.show {
            display: block;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            body {
                overflow-x: hidden;
            }
            
            /* Better touch targets */
            button, .clickable {
                min-height: 44px;
                min-width: 44px;
            }
            
            /* Improve scrolling */
            * {
                -webkit-overflow-scrolling: touch;
            }
        }
        
        /* Loading spinner */
        .app-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #f9fafb;
        }
        
        .spinner {
            border: 4px solid #e5e7eb;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Screen -->
    <div id="app-loading" class="app-loading">
        <div class="text-center">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-gray-600">טוען את האפליקציה...</p>
        </div>
    </div>
    
    <!-- Main App -->
    <div id="root" style="display: none;"></div>
    
    <!-- PWA Install Banner -->
    <div id="pwa-install-banner" class="pwa-install-banner">
        <div class="flex items-center justify-between">
            <div class="flex-1">
                <h3 class="font-semibold text-sm">התקן את האפליקציה</h3>
                <p class="text-xs opacity-90">השתמש באפליקציה כמו אפליקציה רגילה</p>
            </div>
            <div class="flex gap-2 mr-4">
                <button onclick="installPWA()" class="bg-white text-blue-600 px-4 py-2 rounded-lg text-sm font-medium">
                    התקן
                </button>
                <button onclick="hidePWABanner()" class="bg-transparent border border-white px-3 py-2 rounded-lg text-sm">
                    ×
                </button>
            </div>
        </div>
    </div>

    <!-- App Script -->
    <script type="text/babel" src="./app.js"></script>
    
    <!-- PWA Registration and Install Logic -->
    <script>
        let deferredPrompt;
        let installBanner = document.getElementById('pwa-install-banner');
        
        // PWA Loading - Scroll test version
        console.log('🚌 Hebrew Transport PWA v1.0.6 - Document flow scrolling test');
        
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('./sw.js');
                    console.log('✅ Service Worker registered successfully:', registration.scope);
                    
                    // Check for updates
                    registration.addEventListener('updatefound', () => {
                        console.log('🔄 New Service Worker version available');
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // Show update notification
                                showUpdateNotification();
                            }
                        });
                    });
                } catch (error) {
                    console.error('❌ Service Worker registration failed:', error);
                }
            });
        }
        
        // PWA Install Banner
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('📱 PWA install prompt available');
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install banner after 30 seconds if not already installed
            setTimeout(() => {
                if (!window.matchMedia('(display-mode: standalone)').matches) {
                    showPWABanner();
                }
            }, 30000);
        });
        
        function showPWABanner() {
            if (installBanner && deferredPrompt) {
                installBanner.classList.add('show');
            }
        }
        
        function hidePWABanner() {
            if (installBanner) {
                installBanner.classList.remove('show');
            }
        }
        
        async function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const choiceResult = await deferredPrompt.userChoice;
                console.log('PWA install choice:', choiceResult.outcome);
                deferredPrompt = null;
                hidePWABanner();
            }
        }
        
        function showUpdateNotification() {
            if (confirm('גרסה חדשה של האפליקציה זמינה. רוצה לעדכן?')) {
                window.location.reload();
            }
        }
        
        // Hide loading screen when React app is ready
        function hideLoadingScreen() {
            const loadingEl = document.getElementById('app-loading');
            const rootEl = document.getElementById('root');
            
            if (loadingEl && rootEl) {
                loadingEl.style.display = 'none';
                rootEl.style.display = 'block';
            }
        }
        
        // Call this when React app finishes loading
        setTimeout(hideLoadingScreen, 2000);
        
        // Handle app install
        window.addEventListener('appinstalled', () => {
            console.log('✅ PWA installed successfully');
            hidePWABanner();
        });
        
        // Disable zoom on iOS
        document.addEventListener('touchmove', function(event) {
            if (event.scale !== 1) {
                event.preventDefault();
            }
        }, { passive: false });
        
        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>